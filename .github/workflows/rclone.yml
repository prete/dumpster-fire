name: ğŸ»

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:

  test:  
    name: ğŸ•ğŸ•ğŸ•
    
    runs-on: ubuntu-latest

    steps:
      - name: Install rclone
        run: curl https://rclone.org/install.sh | sudo bash

      - name: Configure rclone for s3 
        run: rclone config create s3 s3 \
          env_auth false \
          region other-v2-signature \
          access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }} \
          secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }} \
          endpoint ${{ secrets.AWS_S3_ENDPOINT }}

      - name: Mount s3 storage
        run: rclone -vv mount s3:mp33 $GITHUB_WORKSPACE --daemon --allow-other --allow-non-empty

      - run: ls "$GITHUB_WORKSPACE"

      - run: sudo mount
