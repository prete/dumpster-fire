name: ðŸ»

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:

  test:  
    name: ðŸ•ðŸ•ðŸ•
    
    runs-on: ubuntu-latest

    steps:
      - name: Install rclone
        run: curl https://rclone.org/install.sh | sudo bash

      - name: Configure rclone for s3 
        run: rclone config create s3 s3 \
          env_auth false \
          region other-v2-signature \
          access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }} \
          secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }} \
          endpoint ${{ secrets.AWS_S3_ENDPOINT }}

      - name: Mount s3 storage and so something
        run: |
          rclone -vv mount s3:mp33 "$GITHUB_WORKSPACE" --debug-fuse --daemon --allow-other --allow-non-empty
          until findmnt --mountpoint "$GITHUB_WORKSPACE" --mtab >/dev/null; do :; done
          ls "$GITHUB_WORKSPACE"
